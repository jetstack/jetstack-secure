{{ template "chart.header" . }}
{{ template "chart.description" . }}

{{ template "chart.versionBadge" . }}{{ template "chart.typeBadge" . }}{{ template "chart.appVersionBadge" . }}

## Additional Information

The Jetstack secure agent helm chart installs the Kubernetes agent that connects to The TLS Protect For Kubernetes platform.
It will require a valid JSS organisation with a license to add the new cluster.
You should also choose a unique name for your cluster that it will appear under in the TLPK platform.

## Installing the Chart

First obtain your service account credential, this can be done through the UI or [jsctl](https://github.com/jetstack/jsctl/releases)

For example with `jsctl`:
```
jsctl set organization <MY_ORG>
jsctl auth login
jsctl auth clusters create-service-account <CLUSTER_NAME> | tee credentials.json
{
  "user_id": "<CLUSTER_NAME>1728023974@<MY_ORG>.platform.jetstack.io",
  "user_secret": "REDACTED"
}
```

Once credentials are obtained, there are two ways to install the chart:

Method 1: create secret manually

```
# pre-create secret
kubectl create secret -n jetstack-secure "<SOME_SECRET_NAME>" --from-file=credentials.json
# Install refering to secret
helm upgrade --install --create-namespace -n jetstack-secure jetstack-agent \
  oci://eu.gcr.io/jetstack-secure-enterprise/charts/jetstack-agent \
  --set config.organisation="strange-jones"  --set config.cluster="<CLUSTER_NAME>" \
  --set authentication.secretName="<SOME_SECRET_NAME>"
```

Method 2: Pass secret to chart as a value, it creates the secret

```console
# Installing by passing in service account directly
helm upgrade --install --create-namespace -n jetstack-secure jetstack-agent \
  oci://eu.gcr.io/jetstack-secure-enterprise/charts/jetstack-agent \
  --set config.organisation="strange-jones" --set config.cluster="<CLUSTER_NAME>" \
  --set authentication.createSecret=true --set authentication.secretValue="$HELM_SECRET"
```

{{ template "chart.requirementsSection" . }}

{{ template "chart.valuesSection" . }}

{{ template "helm-docs.versionFooter" . }}
